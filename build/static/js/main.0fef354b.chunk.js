(this["webpackJsonpdrop-serializer-react"]=this["webpackJsonpdrop-serializer-react"]||[]).push([[0],{118:function(e,t,n){},121:function(e,t,n){},123:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(20),i=n.n(o),s=n(6),l=n(7),u=n(9),c=n(8),p=n(12),d=n(25),m=n(49),h=n(69),f=n(70),v=n(31),b=n(126),E=n(74),y=n(21),g=n(52),O=n(4),S=n(27),j=n.n(S),w=function(e,t){return{type:"drop-serializer/PUSH_MESSAGE",payload:{type:e,message:t}}},k=function(e){return{type:"drop-serializer/SELECT_EVENT",payload:e}},D=function(e){return{type:"drop-serializer/SET_EVENT_DATA",payload:e}},N=function(e){return{type:"drop-serializer/SET_SHOW_SETTINGS",payload:e}},_=function(e){return{type:"drop-serializer/SET_SHOW_UPLOAD",payload:e}},T=function(e){return{type:"drop-serializer/SET_SUBMISSION_PENDING",payload:e}},I=function(e){return{type:"drop-serializer/UPDATE_LOADING",payload:e}},C=n(73),z=n.n(C),M=function(e,t){return function(n,r){if(r().dropSerializer.enableQueryParameters){var a=window.location,o=new URLSearchParams(a.search);e?o.set("event",e):o.delete("event"),t?o.set("node",t):o.delete("node");var i=a.protocol+"//"+a.host+a.pathname+"?"+o.toString();window.history.replaceState({path:i},"",i)}}},U=function(e){return function(t,n){n().dropSerializer.eventData;return e?Promise.resolve().then((function(){return t(k(e))})).then((function(){return t(M(e,!1))})).then((function(){return t(I(!0))})).then((function(){return t(D(null))})).then((function(){return t(q())})).then((function(){return t(I(!1))})):Promise.resolve().then((function(){return t(k(e))})).then((function(){return t(M(!1,!1))})).then((function(){return t(D(null))}))}},L=function(e){return function(t,n){var r=n().dropSerializer.selectedEvent;return Promise.resolve().then((function(){return t({type:"drop-serializer/SELECT_NODE",payload:e})})).then((function(){return t(M(r,e))})).then((function(){return t({type:"drop-serializer/LOAD_SESSION"})}))}},P=function(){return function(e,t){var n=t().dropSerializer,r=n.submissionQueue;if(!n.submissionPending&&r.length){var a=r[0];return e(A(a))}}},A=function(e){return function(t,n){var r=e.event_uid,a=n().dropSerializer.domain;return Promise.resolve().then((function(){return t(T(!0))})).then((function(){return j.a.post(a+"/submit/run",e)})).then((function(e){return Promise.resolve().then((function(){return t(w("success","Created submission: "+e.data.receipt))})).then((function(){return t({type:"drop-serializer/SHIFT_SUBMISSIONS"})})).then((function(){return t(T(!1))})).then((function(){return t(x(r,e.data.missing_drops))})).then((function(){return t(P())}))})).catch((function(e){return 422===e.response.status?Promise.resolve().then((function(){return t(w("danger","Submission rejected"))})).then((function(){return t({type:"drop-serializer/SHIFT_SUBMISSIONS"})})).then((function(){return t(T(!1))})).then((function(){return t(P())})):Promise.resolve().then((function(){return t(w("warning","Issue during submission. Retrying ..."))})).then((function(){return new Promise((function(e){window.setTimeout(e,5e3)}))})).then((function(){return t(T(!1))})).then((function(){return t(P())}))}))}},x=function(e,t){return function(n,r){var a=r().dropSerializer,o=a.selectedEvent,i=a.selectedNode;return t?e!==o?Promise.resolve():Promise.resolve().then((function(){return n(w("info","Event data is outdated. Refreshing now ..."))})).then((function(){return n(U(""))})).then((function(){return n(U(o))})).then((function(){return n(L(i))})):Promise.resolve()}},F=function(){return function(e,t){var n=t().dropSerializer,r=n.domain;if(n.enableEventSelector)return j.a.get(r+"/event").then((function(t){return e({type:"drop-serializer/SET_EVENT_LIST",payload:t.data})}))}},q=function(){return function(e,t){var n=t().dropSerializer,r=n.domain,a=n.selectedEvent;if(a)return j.a.get(r+"/event/"+a).then((function(t){return e(D(t.data))}))}},B=(n(118),n(14)),G=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return this.props.eventLoaded?a.a.createElement("a",{href:this.props.sheetLink,className:"text-success",target:"_blank",rel:"noopener noreferrer author"},a.a.createElement(y.a,{variant:"outline-success"},a.a.createElement(B.FontAwesomeIcon,{icon:"file-excel"}))):null}}]),n}(a.a.Component),Q=Object(p.connect)((function(e){var t=e.dropSerializer,n=t.eventData,r=t.eventList,a=r&&r.length>0&&Boolean(n);return{eventLoaded:a,sheetLink:"https://docs.google.com/spreadsheets/d/"+(a?n.sheet_id:"")}}))(G),R=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).state={delay:1e3,disabled:!1,timeout:null},r}return Object(l.a)(n,[{key:"componentWillUnmount",value:function(){this.state.timeout&&(window.clearTimeout(this.state.timeout),this.setState({timeout:null}))}},{key:"render",value:function(){var e=this;return a.a.createElement(y.a,{variant:"success",block:!0,disabled:this.state.disabled,onClick:function(t){return e.submit()}},a.a.createElement("img",{className:"chest-icon",src:"assets/chest.png",alt:""})," ",this.props.dropCount,"\xa0 - \xa0",a.a.createElement(B.FontAwesomeIcon,{icon:"copy"})," Submit Run")}},{key:"submit",value:function(){var e=this;this.props.dispatch((function(e,t){var n=t().dropSerializer,r=n.eventData,a=n.selectedEvent,o=n.selectedNode,i=n.settings,s=n.submissionDrops,l=r.node_drops.filter((function(e){return e.event_node_uid===o})),u=i?i.submitter_name:"",c=l.map((function(e){var t=s.filter((function(t){return t.uid===e.uid&&t.quantity===e.quantity})).shift();return t||(t={uid:e.uid,quantity:e.quantity,count:0,ignored:!1}),t})),p={event_uid:a,event_node_uid:o,submitter:u,drops:c,token:z()()};return Promise.resolve().then((function(){return e({type:"drop-serializer/QUEUE_SUBMISSION",payload:p})})).then((function(){return e({type:"drop-serializer/RESET_SUBMISSION"})})).then((function(){return e(P())}))})),this.setState({disabled:!0,timeout:window.setTimeout((function(){e.setState({disabled:!1,timeout:null})}),this.state.delay)})}}]),n}(a.a.Component),H=Object(p.connect)((function(e){var t=e.dropSerializer.eventData.drops;return{dropCount:e.dropSerializer.submissionDrops.map((function(e){if(e.ignored)return 0;var n=t.filter((function(t){return t.uid===e.uid})).shift();return n&&"Bonus Rate-Up"===n.type?0:e.count})).reduce((function(e,t){return e+t}),0)}}))(R),W=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this;return a.a.createElement(y.a,{variant:"primary",block:!0,onClick:function(t){return e.onClick(t)}},a.a.createElement(B.FontAwesomeIcon,{icon:"filter"})," Toggle Filter")}},{key:"onClick",value:function(e){this.props.dispatch({type:"drop-serializer/SET_SHOW_FILTERS",payload:!this.props.showFilters})}}]),n}(a.a.Component),J=Object(p.connect)((function(e){return{showFilters:e.dropSerializer.showFilters}}))(W);function V(e,t){var n=t.nodeDrop,r=e.dropSerializer,a=r.eventData,o=r.selectedDropUid,i=r.selectedDropQuantity,s=r.selectedDropInitialCount,l=r.settings,u=r.showFilters,c=r.submissionDrops,p=a.drops.filter((function(e){return e.uid===n.uid})).shift(),d=n.quantity>1?n.quantity:p.quantity,m=c.filter((function(e){return e.uid===n.uid&&e.quantity===n.quantity})).shift();return void 0===m&&(m={uid:n.uid,quantity:n.quantity,count:0,ignored:!1}),{drop:p,nodeDrop:n,quantityDisplay:d,selectedDropUid:o,selectedDropQuantity:i,selectedDropInitialCount:s,submissionDrop:m,settings:l,showFilters:u}}function Y(e,t){return{update:function(n,r){return e(function(e,t,n,r){return{type:"drop-serializer/UPDATE_DROP",payload:{uid:e,quantity:t,count:n,ignored:r}}}(t.nodeDrop.uid,t.nodeDrop.quantity,n,r))}}}var K={connect:Object(p.connect)(V,Y),mapDispatchToProps:Y,mapStateToProps:V},$=n(11),X=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this;return a.a.createElement($.a.Control,{type:"text",className:"drop-input",value:this.props.submissionDrop.count,onChange:function(t){return e.onChange(t)},size:"sm"})}},{key:"onChange",value:function(e){var t=parseInt(e.target.value);(isNaN(t)||t<0)&&(t=0),this.props.update(t,!1)}}]),n}(a.a.Component),Z=K.connect(X),ee=new(n(75).Howl)({src:"./sounds/click.mp3"}),te=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(e,r){var a;Object(s.a)(this,n);var o={delay:250,iteratorSkip:2,max:void 0,min:0,step:1,windowLeash:10};return(a=t.call(this,e)).incrementorSettings=Object(O.a)(Object(O.a)({},o),r),a.state={interval:null,iterator:0,running:!1,windowPosition:null,windowListener:null},a}return Object(l.a)(n,[{key:"componentWillUnmount",value:function(){this.stopInterval()}},{key:"onMouseDown",value:function(e){this.state.running||this.startInterval()}},{key:"onMouseMove",value:function(e){}},{key:"onMouseOut",value:function(e){this.state.running&&this.stopInterval()}},{key:"onMouseUp",value:function(e){this.state.running&&(this.state.iterator<=this.incrementorSettings.iteratorSkip&&this.stepCount(),this.stopInterval())}},{key:"onWindowScroll",value:function(e){this.state.running&&(Math.abs(window.scrollY-this.state.windowPosition)>this.incrementorSettings.windowLeash&&this.stopInterval())}},{key:"stepCount",value:function(){var e=this.props.submissionDrop.count+this.incrementorSettings.step;e<this.incrementorSettings.min?e=this.incrementorSettings.min:void 0!==this.incrementorSettings.max&&e>this.incrementorSettings.max&&(e=this.incrementorSettings.max),this.props.update(e,!1),this.props.parent.animate(),this.props.settings.click&&ee.play(),this.props.settings.vibrate&&window.navigator.vibrate&&window.navigator.vibrate(100)}},{key:"startInterval",value:function(){var e=this,t=setInterval((function(){return e.tick()}),this.incrementorSettings.delay),n=window.scrollY,r=function(t){return e.onWindowScroll(t)};window.addEventListener("scroll",r),this.setState({iterator:0,running:!0,interval:t,windowListener:r,windowPosition:n})}},{key:"stopInterval",value:function(){this.state.running&&(clearInterval(this.state.interval),window.removeEventListener("scroll",this.state.windowListener),this.setState({running:!1,interval:null,windowListener:null,windowPosition:null}))}},{key:"tick",value:function(){this.state.iterator>this.incrementorSettings.iteratorSkip&&this.stepCount(),this.setState({iterator:this.state.iterator+1})}}]),n}(a.a.Component);function ne(e,t){var n=t.parent,r=K.mapStateToProps(e,t);return Object(O.a)(Object(O.a)({},r),{},{parent:n})}var re=K.mapDispatchToProps,ae={connect:Object(p.connect)(ne,re),mapDispatchToProps:re,mapStateToProps:ne},oe=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(e){return Object(s.a)(this,n),t.call(this,e,{delay:250,iteratorSkip:2,step:-1,windowLeash:10})}return Object(l.a)(n,[{key:"render",value:function(){var e=this;return a.a.createElement(y.a,{variant:"primary",block:!0,size:"sm",tabIndex:"-1",onMouseDown:function(t){return e.onMouseDown(t)},onMouseMove:function(t){return e.onMouseMove(t)},onMouseOut:function(t){return e.onMouseOut(t)},onMouseUp:function(t){return e.onMouseUp(t)}},a.a.createElement(B.FontAwesomeIcon,{icon:"minus"}))}}]),n}(te),ie=ae.connect(oe),se=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(e){return Object(s.a)(this,n),t.call(this,e,{delay:250,iteratorSkip:2,step:1,windowLeash:10})}return Object(l.a)(n,[{key:"render",value:function(){var e=this;return a.a.createElement("img",{className:"drop-icon",draggable:"false",src:this.props.drop.image,alt:this.props.drop.name,onMouseDown:function(t){return e.onMouseDown(t)},onMouseMove:function(t){return e.onMouseMove(t)},onMouseOut:function(t){return e.onMouseOut(t)},onMouseUp:function(t){return e.onMouseUp(t)}})}}]),n}(te),le=ae.connect(se),ue=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this;return this.props.showFilters?a.a.createElement("div",{className:"drop-toggle",onClick:function(t){return e.onClick(t)}},a.a.createElement(B.FontAwesomeIcon,{className:"drop-toggle-icon",icon:this.props.submissionDrop.ignored?"ban":"check"})):null}},{key:"onClick",value:function(e){this.props.update(0,!this.props.submissionDrop.ignored)}}]),n}(a.a.Component),ce=K.connect(ue),pe=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props.selectedDropUid===this.props.nodeDrop.uid&&this.props.selectedDropQuantity===this.props.nodeDrop.quantity,t=e?this.props.submissionDrop.count-this.props.selectedDropInitialCount:0,n=(t>=0?"+":"-")+(e?Math.abs(t).toString():"");return a.a.createElement("span",{className:"drop-indicator"},n)}}]),n}(a.a.Component),de=K.connect(pe),me=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).state={animating:!1},r}return Object(l.a)(n,[{key:"render",value:function(){return this.props.submissionDrop.ignored&&!this.props.showFilters?null:a.a.createElement("div",{className:"drop "+this.props.settings.columns+(this.state.animating?" animating":"")},a.a.createElement("div",{className:"drop-border"},a.a.createElement("div",{className:"drop-content"},a.a.createElement("div",{className:"drop-icon-box"},a.a.createElement(le,{nodeDrop:this.props.nodeDrop,parent:this}),a.a.createElement(de,{nodeDrop:this.props.nodeDrop}),a.a.createElement("span",{className:"drop-quantity"},this.props.quantityDisplay>1?this.props.quantityDisplay.toLocaleString():"")),a.a.createElement(Z,{nodeDrop:this.props.nodeDrop}),a.a.createElement(ie,{nodeDrop:this.props.nodeDrop,parent:this})),a.a.createElement(ce,{nodeDrop:this.props.nodeDrop})))}},{key:"animate",value:function(){var e=this;this.setState({animating:!0}),setTimeout((function(){return e.setState({animating:!1})}),1)}}]),n}(a.a.Component),he=K.connect(me),fe=n(23),ve=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this;return a.a.createElement($.a.Control,{as:"select",className:"drop-input",value:this.props.submissionDrop.count,onChange:function(t){return e.props.update(parseInt(t.target.value),!1)},size:"sm"},Object(fe.a)(Array(5).keys()).map((function(e){return a.a.createElement("option",{key:e,value:25*e},25*e,"%")})))}}]),n}(a.a.Component),be=K.connect(ve),Ee=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(e){return Object(s.a)(this,n),t.call(this,e,{max:100,step:25})}return Object(l.a)(n,[{key:"render",value:function(){var e=this;return a.a.createElement("img",{className:"drop-icon",draggable:"false",src:this.props.drop.image,alt:this.props.drop.name,onMouseDown:function(t){return e.onMouseDown(t)},onMouseMove:function(t){return e.onMouseMove(t)},onMouseOut:function(t){return e.onMouseOut(t)},onMouseUp:function(t){return e.onMouseUp(t)}})}}]),n}(te),ye=ae.connect(Ee),ge=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(e){return Object(s.a)(this,n),t.call(this,e,{max:100,step:-25})}return Object(l.a)(n,[{key:"render",value:function(){var e=this;return a.a.createElement(y.a,{variant:"primary",block:!0,size:"sm",tabIndex:"-1",onMouseDown:function(t){return e.onMouseDown(t)},onMouseMove:function(t){return e.onMouseMove(t)},onMouseOut:function(t){return e.onMouseOut(t)},onMouseUp:function(t){return e.onMouseUp(t)}},a.a.createElement(B.FontAwesomeIcon,{icon:"minus"}))}}]),n}(te),Oe=ae.connect(ge),Se=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).state={animating:!1},r}return Object(l.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"drop drop-bonus "+this.props.settings.columns+(this.state.animating?" animating":"")},a.a.createElement("div",{className:"drop-border"},a.a.createElement("div",{className:"drop-content"},a.a.createElement("div",{className:"drop-icon-box"},a.a.createElement(ye,{nodeDrop:this.props.nodeDrop,parent:this}),a.a.createElement("span",{className:"drop-indicator"},"Bonus")),a.a.createElement(be,{nodeDrop:this.props.nodeDrop}),a.a.createElement(Oe,{nodeDrop:this.props.nodeDrop,parent:this}))))}},{key:"animate",value:function(){var e=this;this.setState({animating:!0}),setTimeout((function(){return e.setState({animating:!1})}),1)}}]),n}(a.a.Component),je=K.connect(Se),we=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this,t=function(e){return e.event_uid+"_"+e.event_node_uid+"_"+e.uid+"_"+e.quantity};return a.a.createElement("div",{className:"drop-container"},this.props.nodeDrops.map((function(n,r){return e.props.drops[r]&&"Bonus Rate-Up"===e.props.drops[r].type?a.a.createElement(je,{key:t(n),nodeDrop:n}):a.a.createElement(he,{key:t(n),nodeDrop:n})})))}}]),n}(a.a.Component),ke=Object(p.connect)((function(e){var t=e.dropSerializer.selectedNode,n=e.dropSerializer.eventData.node_drops.filter((function(e){return e.event_node_uid===t}));return{drops:n.map((function(t){return e.dropSerializer.eventData.drops.filter((function(e){return e.uid===t.uid})).shift()})),nodeDrops:n}}))(we),De=n(37),Ne=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this;window.setTimeout((function(){e.props.dispatch({type:"drop-serializer/SHIFT_MESSAGES"})}),5e3)}},{key:"render",value:function(){return a.a.createElement(De.a,{variant:this.props.message.type},this.props.message.message)}}]),n}(a.a.Component),_e=Object(p.connect)()(Ne),Te=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return 0===this.props.pendingCount?null:a.a.createElement(De.a,{variant:"warning"},this.props.pendingCount," pending submission(s).")}}]),n}(a.a.Component),Ie=Object(p.connect)((function(e){var t=e.dropSerializer.submissionQueue;return{pendingCount:void 0===t?0:t.length}}))(Te),Ce=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"Messages"},a.a.createElement(Ie,null),this.props.messages.map((function(e){return a.a.createElement(_e,{key:e.key,message:e})})))}}]),n}(a.a.Component),ze=Object(p.connect)((function(e){var t=e.dropSerializer.messages;return void 0===t&&(t=[]),{messages:t}}))(Ce),Me=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this;return a.a.createElement($.a.Control,{as:"select",className:"event-selector",onChange:function(t){return e.updateEvent(t)},value:this.props.selectedEvent},[a.a.createElement("option",{key:0,value:""},"Select a event")].concat(this.props.eventList.map((function(e,t){return a.a.createElement("option",{key:t+1,value:e.uid},e.name)}))))}},{key:"updateEvent",value:function(e){this.props.dispatch(U(e.target.value))}}]),n}(a.a.Component),Ue=Object(p.connect)((function(e){return{selectedEvent:e.dropSerializer.selectedEvent,eventList:e.dropSerializer.eventList}}))(Me),Le=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this;return a.a.createElement($.a.Control,{as:"select",className:"event-selector",onChange:function(t){e.updateNode(t)},value:this.props.selectedNode},[a.a.createElement("option",{key:0,value:""},"Select a node")].concat(this.props.nodeList.map((function(e,t){return a.a.createElement("option",{key:t+1,value:e.uid},e.name)}))))}},{key:"updateNode",value:function(e){this.props.dispatch(L(e.target.value))}}]),n}(a.a.Component),Pe=Object(p.connect)((function(e){return{nodeList:e.dropSerializer.eventData.nodes,selectedNode:e.dropSerializer.selectedNode}}))(Le),Ae=n(22);function xe(e,t){var n=t.property;return{property:n,value:e.dropSerializer.settings[n]}}function Fe(e,t){return{update:function(n){return e(function(e,t){return{type:"drop-serializer/UPDATE_SETTING",payload:{property:e,value:t}}}(t.property,n))}}}var qe={connect:Object(p.connect)(xe,Fe),mapDispatchToProps:Fe,mapStateToProps:xe},Be=qe.connect((function(e){e.property;var t=e.value,n=e.update;return a.a.createElement($.a.Group,{controlId:"settingPlayClick"},a.a.createElement($.a.Label,null,"Play Click"),a.a.createElement($.a.Control,{as:"select",value:t?"Yes":"No",onChange:function(e){return n("Yes"===e.target.value)}},a.a.createElement("option",null,"Yes"),a.a.createElement("option",null,"No")))})),Ge=qe.connect((function(e){e.property;var t=e.value,n=e.update;return a.a.createElement($.a.Group,{controlId:"settingNumberOfColumns"},a.a.createElement($.a.Label,null,"Number of Columns"),a.a.createElement($.a.Control,{as:"select",value:t,onChange:function(e){return n(e.target.value)}},a.a.createElement("option",{value:"columns_auto"},"Auto"),a.a.createElement("option",{value:"columns_2"},"2"),a.a.createElement("option",{value:"columns_4"},"4"),a.a.createElement("option",{value:"columns_6"},"6"),a.a.createElement("option",{value:"columns_8"},"8"),a.a.createElement("option",{value:"columns_12"},"12"),a.a.createElement("option",{value:"columns_16"},"16")))})),Qe=qe.connect((function(e){e.property;var t=e.value,n=e.update;return a.a.createElement($.a.Group,{controlId:"settingSubmitterName"},a.a.createElement($.a.Label,null,"Submitter Name"),a.a.createElement($.a.Control,{value:t,onChange:function(e){return n(e.target.value)}}))})),Re=qe.connect((function(e){e.property;var t=e.value,n=e.update;return a.a.createElement($.a.Group,{controlId:"settingVibrate"},a.a.createElement($.a.Label,null,"Vibrate"),a.a.createElement($.a.Control,{as:"select",value:t?"Yes":"No",disabled:!window.navigator.vibrate,onChange:function(e){return n("Yes"===e.target.value)}},a.a.createElement("option",null,"Yes"),a.a.createElement("option",null,"No")))})),He=qe.connect((function(e){e.property;var t=e.value,n=e.update;return a.a.createElement($.a.Group,{controlId:"settingAppWidth"},a.a.createElement($.a.Label,null,"App Width"),a.a.createElement($.a.Control,{as:"select",value:t,onChange:function(e){return n(e.target.value)}},a.a.createElement("option",{value:"width_full"},"Full Width"),a.a.createElement("option",{value:"width_480"},"480px"),a.a.createElement("option",{value:"width_720"},"720px"),a.a.createElement("option",{value:"width_1080"},"1080p"),a.a.createElement("option",{value:"width_1200"},"1200p"),a.a.createElement("option",{value:"width_1440"},"1440p"),a.a.createElement("option",{value:"width_2160"},"2160p")))})),We=["default","cerulean","cosmo","cyborg","darkly","flatly","journal","litera","lumen","lux","materia","minty","pulse","sandstone","simplex","sketchy","slate","solar","spacelab","superhero","united","yeti"],Je=qe.connect((function(e){e.property;var t=e.value,n=e.update;return a.a.createElement($.a.Group,{controlId:"settingAppTheme"},a.a.createElement($.a.Label,null,"Theme"),a.a.createElement($.a.Control,{as:"select",value:t,onChange:function(e){return n(e.target.value)}},We.map((function(e){return a.a.createElement("option",{key:e,value:"theme_".concat(e)},e)}))))}));function Ve(e){return{showSettings:e.dropSerializer.showSettings}}function Ye(e){return{hide:function(){return e(N(!1))},show:function(){return e(N(!0))},toggle:function(){return e((function(e,t){var n=t().dropSerializer.showSettings;return e(N(!n))}))}}}var Ke={connect:Object(p.connect)(Ve,Ye),mapDispatchToProps:Ye,mapStateToProps:Ve},$e=Ke.connect((function(e){var t=e.showSettings,n=(e.show,e.hide);return a.a.createElement(Ae.a,{show:t,onHide:function(e){return n()}},a.a.createElement(Ae.a.Header,{closeButton:!0},a.a.createElement(Ae.a.Title,null,"Settings")),a.a.createElement(Ae.a.Body,null,a.a.createElement(Qe,{property:"submitter_name"}),a.a.createElement(He,{property:"width"}),a.a.createElement(Ge,{property:"columns"}),a.a.createElement(Je,{property:"theme"}),a.a.createElement(Be,{property:"click"}),a.a.createElement(Re,{property:"vibrate"})))})),Xe=Ke.connect((function(e){e.showSettings;var t=e.show;e.hide;return a.a.createElement(y.a,{variant:"outline-danger",className:"settings",onClick:function(e){return t(e)}},a.a.createElement(B.FontAwesomeIcon,{icon:"cog"}))})),Ze=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"toggle",value:function(){this.props.dispatch(_(!this.props.showUpload))}},{key:"render",value:function(){var e=this;return this.props.eventLoaded&&this.props.parsable&&this.props.selectedNode?a.a.createElement("a",{href:"Upload drop screenshots",onClick:function(t){t.preventDefault(),e.toggle()}},a.a.createElement(y.a,{variant:"outline-info"},"Upload drop screenshots\xa0\xa0",a.a.createElement(v.a,{icon:"file-upload"}))):null}}]),n}(a.a.Component),et=Object(p.connect)((function(e){var t=e.dropSerializer,n=t.eventData,r=t.eventList,a=t.selectedNode,o=t.showUpload,i=r&&r.length>0&&Boolean(n);return{eventLoaded:i,parsable:!!i&&n.parsable,selectedNode:a,showUpload:o}}))(Ze),tt=n(36),nt=n.n(tt),rt=n(54),at=n(125),ot=n(127),it=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).state={downloading:!1,type:"simple",files:[]},r}return Object(l.a)(n,[{key:"addFiles",value:function(e){for(var t=this.state.files.slice(),n=0;n<e.length;n++)t.push({file:e[n],completed:!1,failed:!1,progress:0});this.setState({files:t})}},{key:"download",value:function(){var e=Object(rt.a)(nt.a.mark((function e(){var t,n,r;return nt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setState({downloading:!0});case 2:t=0,n=0;case 4:if(!(n<this.state.files.length)){e.next=18;break}if(!(r=this.state.files[n]).completed){e.next=8;break}return e.abrupt("continue",15);case 8:t++,this.downloadFile(n,r).then((function(){t--}));case 10:if(!(t>=5)){e.next=15;break}return e.next=13,new Promise((function(e){return setTimeout(e,100)}));case 13:e.next=10;break;case 15:n++,e.next=4;break;case 18:if(!(t>0)){e.next=23;break}return e.next=21,new Promise((function(e){return setTimeout(e,100)}));case 21:e.next=18;break;case 23:return e.next=25,this.setState({downloading:!1});case 25:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"downloadFile",value:function(){var e=Object(rt.a)(nt.a.mark((function e(t,n){var r,a,o,i=this;return nt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props.domain+"/submit/screenshot",(a=Object(fe.a)(this.state.files))[t].failed=!1,a[t].progress=0,e.next=6,this.setState({files:a});case 6:return e.prev=6,(o=new FormData).append("event_uid",this.props.selectedEvent),o.append("event_node_uid",this.props.selectedNode),o.append("submitter",this.props.submitter),o.append("type",this.state.type),o.append("files[]",n.file),e.next=15,j.a.post(r,o,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){(a=Object(fe.a)(i.state.files))[t].progress=e.loaded/e.total*100,i.setState({files:a})}});case 15:return(a=Object(fe.a)(this.state.files))[t].completed=!0,e.next=19,this.setState({files:a});case 19:e.next=27;break;case 21:return e.prev=21,e.t0=e.catch(6),(a=Object(fe.a)(this.state.files))[t].failed=!0,e.next=27,this.setState({files:a});case 27:return e.abrupt("return",!0);case 28:case"end":return e.stop()}}),e,this,[[6,21]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"readyToUpload",value:function(){return!this.state.downloading&&this.state.files.length>0&&0===this.state.files.filter((function(e){return e.failed})).length&&this.state.files.filter((function(e){return!e.completed&&!e.failed})).length>0}},{key:"readyToRetry",value:function(){return!this.state.downloading&&this.state.files.length>0&&this.state.files.filter((function(e){return e.failed})).length>0}},{key:"isComplete",value:function(){return!this.state.downloading&&this.state.files.length>0&&0===this.state.files.filter((function(e){return!e.completed})).length}},{key:"reset",value:function(){this.setState({files:[]})}},{key:"hide",value:function(){this.state.downloading||(this.props.dispatch(_(!1)),this.reset())}},{key:"render",value:function(){var e=this,t=/^\d+$/.test(this.props.selectedEvent);return a.a.createElement(Ae.a,{show:this.props.show,onHide:function(){return e.hide()}},a.a.createElement(Ae.a.Header,{closeButton:!0},a.a.createElement(Ae.a.Title,null,"Upload")),a.a.createElement(Ae.a.Body,null,this.state.downloading?null:a.a.createElement($.a,null,this.state.files.length?null:a.a.createElement("div",null,a.a.createElement(De.a,{variant:"info"},"Uploading to ",t?"event":""," ",a.a.createElement("b",null,this.props.selectedEventName)," ","node ",a.a.createElement("b",null,this.props.selectedNodeName)," ","as ",a.a.createElement("b",null,this.props.submitter)),a.a.createElement($.a.Group,null,a.a.createElement($.a.Label,null,"Type"),a.a.createElement($.a.Control,{as:"select",value:this.state.type,onChange:function(t){e.setState({type:t.target.value})}},a.a.createElement("option",{value:"simple"},"Simple"),a.a.createElement("option",{value:"full"},"Full")),a.a.createElement($.a.Text,null,a.a.createElement("ul",null,a.a.createElement("li",null,"Simple: Only first screen. Currency + QP + Exp are ignored"),a.a.createElement("li",null,"Full: All drop screens are required for submission to be successful")))),a.a.createElement($.a.Group,null,a.a.createElement($.a.Label,null,"Files"),a.a.createElement("div",{className:"custom-file"},a.a.createElement("input",{type:"file",className:"custom-file-input",accept:"image/*",multiple:"multiple",onChange:function(t){e.addFiles(t.target.files)}}),a.a.createElement("label",{className:"custom-file-label"},"Select Files")))),this.readyToUpload()?a.a.createElement($.a.Group,null,a.a.createElement(at.a,{className:"btn-block"},a.a.createElement(y.a,{variant:"danger",onClick:function(){return e.reset()}},"Reset"),a.a.createElement(y.a,{onClick:function(){return e.download()}},"Upload All"))):null,this.readyToRetry()?a.a.createElement($.a.Group,null,a.a.createElement(at.a,{className:"btn-block"},a.a.createElement(y.a,{variant:"danger",onClick:function(){return e.reset()}},"Reset"),a.a.createElement(y.a,{onClick:function(){return e.download()}},"Retry Failed"))):null,this.isComplete()?a.a.createElement("div",null,a.a.createElement("p",null,"All Complete"),a.a.createElement(y.a,{block:!0,variant:"success",onClick:function(){return e.reset()}},"New Uploads")):null),this.state.files.map((function(t,n){return t.completed?null:a.a.createElement("div",{key:n},a.a.createElement("h5",null,t.file.name),e.state.downloading&&!t.failed?a.a.createElement(ot.a,{animated:!0,striped:!0,now:t.progress}):null,t.failed?a.a.createElement("p",{className:"text-danger"},"Failed"):null,a.a.createElement("br",null))}))))}}]),n}(a.a.Component),st=Object(p.connect)((function(e){var t,n,r,a,o=e.dropSerializer,i=o.domain,s=o.selectedEvent,l=o.selectedNode,u=o.settings,c=o.showUpload,p=o.eventList,d=o.eventData,m=null!==(t=null===(n=(null!==p&&void 0!==p?p:[]).find((function(e){return e.uid===s})))||void 0===n?void 0:n.name)&&void 0!==t?t:"",h=null!==(r=null===d||void 0===d||null===(a=d.nodes.find((function(e){return e.uid===l})))||void 0===a?void 0:a.name)&&void 0!==r?r:"";return{domain:i,selectedEvent:s,selectedEventName:m,selectedNode:l,selectedNodeName:h,show:c,submitter:u.submitter_name}}))(it),lt=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.props.dispatch(function(e){var t=Object(O.a)({domain:"https://submissions.atlasacademy.io",enableEventSelector:!0,enableQueryParameters:!0,messageKey:0,messages:[],nodeSave:[],selectedEvent:"",selectedNode:"",selectedDropUid:null,selectedDropQuantity:null,selectedDropInitialCount:null,settings:{},showFilters:!1,showSettings:!1,showUpload:!1,submissionPending:!1,submissionQueue:[]},e);if(t.enableQueryParameters){var n=new URLSearchParams(window.location.search);t.selectedEvent||(t.selectedEvent=n.has("event")?n.get("event"):""),t.selectedEvent&&!t.selectedNode&&(t.selectedNode=n.has("node")?n.get("node"):"")}return function(e,n){return Promise.resolve().then((function(){return e({type:"drop-serializer/INIT_STATE",payload:t})})).then((function(){return e(I(!0))})).then((function(){return e({type:"drop-serializer/LOAD_SETTINGS"})})).then((function(){return e(F())})).then((function(){return e(q())})).then((function(){return e({type:"drop-serializer/LOAD_SESSION"})})).then((function(){return e({type:"drop-serializer/LOAD_SUBMISSION_QUEUE"})})).then((function(){return e(P()),Promise.resolve()})).then((function(){return""===n().dropSerializer.settings.submitter_name?e(N(!0)):Promise.resolve()})).then((function(){return e(I(!1))}))}}(this.props.options))}},{key:"render",value:function(){var e,t=(null!==(e=this.props.settings.theme)&&void 0!==e?e:"theme_default").replace("theme_","");return a.a.createElement(g.b,null,a.a.createElement(g.a,null,"default"===t?null:a.a.createElement("link",{key:"theme",rel:"stylesheet",href:"https://cdn.jsdelivr.net/npm/bootswatch@4.6.0/dist/".concat(t,"/bootstrap.min.css")})),a.a.createElement("div",{id:"drop-serializer",className:this.props.settings.width},a.a.createElement("div",{className:"title"},a.a.createElement(b.a,null,a.a.createElement(E.a,{md:12,lg:6},a.a.createElement("h1",null,"Drop Serializer",a.a.createElement("small",null," by ",a.a.createElement("a",{href:"https://discord.gg/TKJmuCR"},"Atlas Academy")))),a.a.createElement(E.a,{md:12,lg:6},a.a.createElement("div",{className:"links"},a.a.createElement(et,null),a.a.createElement(Q,null),a.a.createElement("a",{href:"https://github.com/atlasacademy/drop-serializer-react",className:"text-secondary",target:"_blank",rel:"noopener noreferrer author"},a.a.createElement(y.a,{variant:"outline-secondary"},a.a.createElement(v.a,{icon:["fab","github"]}))),a.a.createElement("a",{href:"https://discord.gg/TKJmuCR",className:"text-secondary",target:"_blank",rel:"noopener noreferrer author"},a.a.createElement(y.a,{variant:"outline-secondary"},a.a.createElement(v.a,{icon:["fab","discord"]}))),a.a.createElement(Xe,null))))),this.props.eventsLoaded&&a.a.createElement(Ue,null),this.props.eventLoaded&&a.a.createElement(Pe,null),this.props.nodeSelected&&a.a.createElement("div",null,a.a.createElement(ke,null),a.a.createElement(b.a,null,a.a.createElement(E.a,null,a.a.createElement(J,null)),a.a.createElement(E.a,null,a.a.createElement(H,null)))),a.a.createElement($e,null),a.a.createElement(st,null),this.props.isLoading&&a.a.createElement("div",{className:"loading"},a.a.createElement("div",{className:"loading-content"},a.a.createElement(v.a,{icon:"spinner",spin:!0}))),a.a.createElement(ze,null)))}}]),n}(a.a.Component),ut=Object(p.connect)((function(e,t){var n=e.dropSerializer,r=n.eventData,a=n.eventList,o=n.isLoading,i=n.selectedEvent,s=n.selectedNode,l=n.settings,u=t.options,c=a&&a.length>0,p=c&&Boolean(r);return{eventsLoaded:c,eventLoaded:p,isLoading:o,nodeSelected:!o&&p&&Boolean(i)&&Boolean(s),options:u,settings:l}}))(lt);function ct(e,t){switch(t.type){case"drop-serializer/INIT_STATE":return Object(O.a)(Object(O.a)({},e),t.payload);case"drop-serializer/LOAD_SESSION":var n=e.selectedEvent,r=e.selectedNode,a=n+"_"+r,o=window.localStorage.getItem(a),i=null===o?[]:JSON.parse(o);return n&&r||(i=[]),Object(O.a)(Object(O.a)({},e),{},{submissionDrops:i});case"drop-serializer/LOAD_SETTINGS":var s=window.localStorage.getItem("settings"),l=null===s?[]:JSON.parse(s),u=Object(O.a)(Object(O.a)({},{submitter_name:"",click:!0,columns:"columns_auto",vibrate:!0,width:"width_full",theme:"theme_default"}),l);return Object(O.a)(Object(O.a)({},e),{},{settings:u});case"drop-serializer/LOAD_SUBMISSION_QUEUE":var c=window.localStorage.getItem("submissions"),p=null===c?[]:JSON.parse(c);return Object(O.a)(Object(O.a)({},e),{},{submissionQueue:p});case"drop-serializer/QUEUE_SUBMISSION":var d=t.payload,m=e.submissionQueue;return m.push(d),window.localStorage.setItem("submissions",JSON.stringify(m)),Object(O.a)(Object(O.a)({},e),{},{submissionQueue:m});case"drop-serializer/PUSH_MESSAGE":var h=e.messageKey,f=e.messages,v=Object(O.a)(Object(O.a)({},t.payload),{},{key:h++}),b=[].concat(Object(fe.a)(f),[v]);return Object(O.a)(Object(O.a)({},e),{},{messageKey:h,messages:b});case"drop-serializer/RESET_SUBMISSION":var E=e.selectedEvent+"_"+e.selectedNode,y=e.eventData.drops,g=e.submissionDrops.map((function(e){var t=y.filter((function(t){return t.uid===e.uid})).shift();return t&&"Bonus Rate-Up"===t.type?e:Object(O.a)(Object(O.a)({},e),{},{count:0})}));return window.localStorage.setItem(E,JSON.stringify(g)),Object(O.a)(Object(O.a)({},e),{},{selectedDropUid:null,selectedDropQuantity:null,selectedDropInitialCount:null,submissionDrops:g});case"drop-serializer/SELECT_EVENT":return Object(O.a)(Object(O.a)({},e),{},{selectedEvent:t.payload,selectedNode:""});case"drop-serializer/SELECT_NODE":return Object(O.a)(Object(O.a)({},e),{},{selectedNode:t.payload});case"drop-serializer/SET_EVENT_LIST":return Object(O.a)(Object(O.a)({},e),{},{eventList:t.payload});case"drop-serializer/SET_EVENT_DATA":return Object(O.a)(Object(O.a)({},e),{},{eventData:t.payload});case"drop-serializer/SET_SHOW_FILTERS":return Object(O.a)(Object(O.a)({},e),{},{showFilters:t.payload});case"drop-serializer/SET_SHOW_SETTINGS":return Object(O.a)(Object(O.a)({},e),{},{showSettings:t.payload});case"drop-serializer/SET_SHOW_UPLOAD":return Object(O.a)(Object(O.a)({},e),{},{showUpload:t.payload});case"drop-serializer/SET_SUBMISSION_PENDING":return Object(O.a)(Object(O.a)({},e),{},{submissionPending:t.payload});case"drop-serializer/SHIFT_MESSAGES":var S=e.messages.slice(1);return Object(O.a)(Object(O.a)({},e),{},{messages:S});case"drop-serializer/SHIFT_SUBMISSIONS":var j=e.submissionQueue.slice(1);return window.localStorage.setItem("submissions",JSON.stringify(j)),Object(O.a)(Object(O.a)({},e),{},{submissionQueue:j});case"drop-serializer/UPDATE_DROP":var w=e.selectedEvent,k=e.selectedNode,D=t.payload,N=D.uid,_=D.quantity,T=D.count,I=D.ignored,C=w+"_"+k,z=e.eventData.node_drops.filter((function(e){return e.event_node_uid===k})),M=e.submissionDrops.filter((function(e){return e.uid===N&&e.quantity===_})).shift(),U=z.map((function(t){var n=e.submissionDrops.filter((function(e){return e.uid===t.uid&&e.quantity===t.quantity})).shift();return void 0===n&&(n={uid:t.uid,quantity:t.quantity,count:0,ignored:!1}),n.uid===N&&n.quantity===_&&(n=Object(O.a)(Object(O.a)({},n),{},{count:T,ignored:I})),n})),L=Object(O.a)(Object(O.a)({},e),{},{submissionDrops:U});return window.localStorage.setItem(C,JSON.stringify(U)),e.selectedDropUid===N&&e.selectedDropQuantity===_||(L.selectedDropUid=N,L.selectedDropQuantity=_,L.selectedDropInitialCount=M?M.count:0),L;case"drop-serializer/UPDATE_LOADING":return Object(O.a)(Object(O.a)({},e),{},{isLoading:t.payload});case"drop-serializer/UPDATE_SETTING":var P=Object(O.a)({},e),A=Object(O.a)({},P.settings);return A[t.payload.property]=t.payload.value,P.settings=A,window.localStorage.setItem("settings",JSON.stringify(A)),P;default:return void 0===e?{settings:{}}:e}}n(121);var pt=function(e){Object(u.a)(n,e);var t=Object(c.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).store=Object(m.createStore)({},[Object(d.applyMiddleware)(f.a)]),r}return Object(l.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{id:"app"},a.a.createElement(p.Provider,{store:this.store},a.a.createElement(h.DynamicModuleLoader,{modules:[{id:"drop-serializer",reducerMap:{dropSerializer:ct}}]},a.a.createElement(ut,{options:{domain:"https://submissions.atlasacademy.io",enableEventSelector:!0}}))))}}]),n}(a.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(122);var dt=n(13),mt=n(19),ht=n(55);dt.library.add(mt.a),dt.library.add(mt.b),dt.library.add(mt.c),dt.library.add(mt.d),dt.library.add(mt.e),dt.library.add(mt.f),dt.library.add(mt.g),dt.library.add(mt.h),dt.library.add(mt.i),dt.library.add(mt.j),dt.library.add(ht.a),dt.library.add(ht.b),i.a.render(a.a.createElement(pt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},81:function(e,t,n){e.exports=n(123)}},[[81,1,2]]]);
//# sourceMappingURL=main.0fef354b.chunk.js.map